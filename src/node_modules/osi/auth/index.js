import firebase from '../../../utils/database.react.js'

const Auth = firebase.auth()

let initialized = false
let currentUser = Auth.currentUser

Auth.onAuthStateChanged(user => {
  currentUser = user
  if (!initialized) initialized = true
})

export const requireAuth = (nextState, replace, done) => {
  const intId = setInterval(() => {
    if (initialized) {
      if (!currentUser || !currentUser.uid) replace('/login')

      clearInterval(intId)
      done()
    }
  }, 80)
}

export default Auth
