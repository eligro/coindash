import React from 'react'
import { Button, OverlayTrigger, Tooltip } from 'react-bootstrap'
import { Card } from 'osi/components'
import FontAwesome from 'react-fontawesome'

import './position-card.css'

import { currencyFormat } from '../dashboard.react'

const tls = i => (+(+i).toFixed(4)).toLocaleString(...currencyFormat)
const nf = i => new Intl.NumberFormat().format(+(+i).toFixed(4))

const comm = labelValue => {
    // Nine Zeroes for Billions
  return Math.abs(Number(labelValue)) >= 1.0e+9

    ? tls(Math.abs(Number(labelValue)) / 1.0e+9) + 'B'
    // Six Zeroes for Millions
    : Math.abs(Number(labelValue)) >= 1.0e+6

    ? tls(Math.abs(Number(labelValue)) / 1.0e+6) + 'M'
    // Three Zeroes for Thousands
    : Math.abs(Number(labelValue)) >= 1.0e+3

    ? tls(Math.abs(Number(labelValue)) / 1.0e+3) + 'K'

    : tls(Math.abs(Number(labelValue)))
}

class PositionItem extends React.Component {
  constructor (props) {
    super(props)

    this.state = {starred: false}
  }
  getName () {
    return `${this.props.item.long} (${this.props.item.short})`
  }

  render () {
    if (!this.props || !this.props.item) {
      return
    }
    let { item } = this.props

    let actions = (<OverlayTrigger placement='bottom' overlay={<Tooltip id='star-token'>Star</Tooltip>}>
      <Button onClick={this.props.starToggle} >
        <FontAwesome name='star' />
      </Button>
    </OverlayTrigger>)

    let isIncrease = !this.props.item.cap24hrChange.toString().match(/^-/)

    return (
      <Card title={`${item.short} â€” ${item.long}`} className={`position  ${isIncrease ? `increase` : `decrease`} ${this.props.starred && `starred`}`} headerActions={actions}>
        <h3>{tls(this.props.item.price)} <small>{nf(this.props.item.cap24hrChange)}%</small></h3>
        <card-footer>
          <p className='marketcap'><value>{comm((+this.props.item.mktcap).toFixed(2))}</value> <label><FontAwesome name='globe' /> Mktcap</label></p>
          <p className='volume'><value>{comm(this.props.item.volume)}</value> <label><FontAwesome name='heartbeat' /> Volume</label></p>
        </card-footer>
      </Card>
    )
  }
}

export default PositionItem
