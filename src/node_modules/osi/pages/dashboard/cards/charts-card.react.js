import React, { Component } from 'react'
import { Button, OverlayTrigger, Tooltip, ButtonGroup } from 'react-bootstrap'
import FontAwesome from 'react-fontawesome'
import Card from 'osi/components/card/card.react'
import StocksChart from '../charts/StocksChart.react'
import StocksChartRisk from '../../../../../components/common/charts/stocks/StocksChartRisk.react'
import AssetAllocationChart from '../../../../../components/common/charts/stocks/AssetAllocationChart.react'
import ChartNavigation from '../../../../../components/pages/dashboard/ChartNavigation.react'

import './charts-card.css'

const Valuable = props => (<OverlayTrigger placement='top' overlay={<Tooltip id='{props.className}-valuable'>Your {props.className} valuable token</Tooltip>}>
  <div className={props.className}>

    <button onClick={props.onClick}>{props.children}</button>
  </div>
</OverlayTrigger>)

class ChartsCard extends Component {
  constructor (props, context) {
    super(props, context)
    this.state = { selectedChart: 1, showError: true, showAddToken: false, token: { address: '', symbol: '', decimal: '', ico_contract_address: '' } }
  }
  render () {
    let actions = (<OverlayTrigger placement='bottom' overlay={<Tooltip id='add-token'>Refresh</Tooltip>}>
      <Button onClick={this.props.refreshChart} >
        <FontAwesome name='refresh' />
      </Button>
    </OverlayTrigger>)

    let title = 'Benchmark'
    if (this.props.statusText && this.props.statusText > 0 && this.props.statusText < 100) {
      title += `... ${Math.floor(+this.props.statusText).toLocaleString()}% processed`
    }

    let charts = [
      {chartId: 1, title: 'Performance', icon: 'area-chart'},
      {chartId: 2, title: 'Risk', icon: 'industry', off: false},
      {chartId: 3, title: 'Allocation', icon: 'pie-chart'}
    ]

    return (
      <Card className='charts' title={title} headerActions={actions}>
        {false && <ChartNavigation handleSelectCB={this.chartSelected} statusText={this.props.statusText} handleRefreshCB={this.props.refreshChart} /> }
        {this.state.selectedChart === 1 &&
            // this.props.chartData &&
            // this.props.portfolioDayDataByDate &&
            // this.props.exchanges &&
          <StocksChart chartData={this.props.chartData} dayDataByDate={this.props.portfolioDayDataByDate} exchanges={this.props.exchanges} />}
        {this.state.selectedChart === 2 && <StocksChartRisk />}
        {this.state.selectedChart === 3 && <AssetAllocationChart balances={this.props.balances} />}

        <card-footer>
          <ButtonGroup justified className='footer-children'>
            {charts.filter(c => !c.off).map(c => (
              <Button onClick={() => this.setSelectedChart(c.chartId)} className={['footer-child', (this.state.selectedChart === c.chartId ? 'active' : '')].join(' ')} key={c.title}>
                <FontAwesome name={c.icon} />
                <span>{c.title}</span>
              </Button>
            ))}
          </ButtonGroup>
        </card-footer>
      </Card>
    )
  }

  setSelectedChart (chartId) {
    this.setState({selectedChart: chartId})
  }
}

export default ChartsCard
